---
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    includes:
      after_body: insert-logo.html
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
    seal: false
editor_options: 
  chunk_output_type: console
---

class: center, middle, hide-logo

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_accent(
  base_color = "#00000e",
  header_font_google = google_font("Merriweather"),
  text_font_google   = google_font("Avenir Next"),
  code_font_google   = google_font("Fira Mono")
)
```

```{css, echo=FALSE}
pre {
  background: #F8F8F8;
  max-width: 100%;
  overflow-x: scroll;
}
```

```{css, echo=FALSE}
.scroll-output {
  height: 80%;
  overflow-y: scroll;
}
```

```{r xaringan-panelset, echo=FALSE}
xaringanExtra::use_panelset()
```

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)

# Load packages for entire presentation here

#Set Working Directory to subfolder of Website

library(tidyverse)
library(lubridate)
library(scales)
library(rstudioapi)

#setwd(dirname(getActiveDocumentContext()$path))

```

# Introduction to R

## by

```{r, echo=FALSE, out.width="50%"}
knitr::include_graphics("GraphicsSlides/Logo RUG hell.png")
```

##### Author/Presenter: Nina & Sven
##### Last updated: _`r Sys.time()`_

---

class: hide-logo, center, middle

```{r, echo=FALSE, out.width="50%"}
knitr::include_graphics("GraphicsSlides/Logo RUG hell.png")
```

---

### Goals for today's session

- Introduction / Welcome
- Why should you learn R
- Installing R and R Studio on your Machine 
- Getting a first overview over R Studio 
- Getting to know Base R commands 
- Load excel and CSV files into R

---

### Content



---
## Why should you learn R? 

.scroll-output[
```{r, warning = F, message = F}


trade_data <- read_csv("trade_data.csv", col_types = cols(`Period 1,2` = "d"))

plot <- trade_data |>
  rename(Country = `Commercial partner`, Period = `Period 1,2`, Tariff = `Kind of rate`,
         CHF_Value = `Value (CHF)`, Duties_CHF = `Amount of customs duties (CHF)`) |> 
  select(Country, Period, Tariff, Duties_CHF, Product) |> 
    mutate(
    Tariff = case_when(Tariff == "Total trade" ~ "Total_Trade",
                    Tariff == "10 - Normal rate" ~ "Normal_Rate",
                    Tariff == "20 - Reduced rate" ~ "Reduced_Rate",
                    Tariff == "30 - Exemption" ~ "Exemption",
                    TRUE ~ "Other")) |> 
  group_by(Country, Period, Tariff, Product) |> 
  summarize(Duties_CHF = max(Duties_CHF)) |> 
  pivot_wider(names_from = Tariff, values_from = Duties_CHF) |> 
  ungroup() |> 
  replace_na(list(Normal_Rate = 0,
                  Total_Trade = 0,
                  Reduced_Rate = 0,
                  Exemption = 0)) |> 
  mutate(Util_Rate = (Exemption + Reduced_Rate) / Total_Trade) |> 
  filter(Country == "India") |> 
  ggplot(aes(x = Period, y = Util_Rate, color = as_factor(Product)))+
  geom_point(size = 3)+
  geom_line(size = 0.8)+
  scale_y_continuous(breaks = seq(0,1.2, by = 0.2), labels = percent_format())+
  scale_x_continuous(breaks = seq(2000,2018, by = 2))+
  expand_limits(y = c(0, 1))+
  theme_minimal()+
  labs(title = "Adjusted Utilization Rate 2000 - 2018")+
  theme(plot.title  = element_text(size = 22, hjust = 0.5, face = "bold"),
        axis.title  = element_blank(), 
        axis.text = element_text(size = 14),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        legend.text = element_text(size = 12))
```
]
---


```{r, echo = F, message = F, dpi = 300, out.width = "90%", warning = F}
plot
```


---
Basic Concepts - Strings, Vectors, Integers

In our R environment, we can store all sorts of objects and data.


```{r}
first_number <- 100
second_number <- 200
first_number + second_number
```

```{r}
#other data types
first_string <- "this is a string"
second_string <- "this is another string"

#first_string + second_string
nchar(first_string)
```

```{r}
typeof(first_string)
typeof(first_number)
```

```{r}
first_vector <- c(1,2,3,4)
second_vector <- c(5,6,7,8)

first_vector + second_vector
```

Data Frames or Tibbles are a very important concept and will be used a lot when working with data!
```{r}
a <- tibble(x = first_vector, y = second_vector)
print(a)
plot(a)
```

---

## Working with Tibbles 


.pull-left[

```{r, echo = F, out.width= "60%"}
knitr::include_graphics("GraphicsSlides/palmerpenguins_package.png")
```
]

.pull-right[
```{r}
#install.packages("palmerpenguins")
penguins <- palmerpenguins::penguins
```
]

```{r}
head(penguins, 5)
```

---

Working with Tibbles 
Simple Subsetting

You can subset every tibble as follows: 

- row and column: 
  `tibble_name[row_index, column_index/name] `
- row only 
  tibble_name[row_index,]
- column only 
  `tibble_name[column_index/name]` OR `tibble_name[,column_index/name]`
  
  
Lets get the second row and third Column of the penguins data 

```{r}
penguins[2,3]
penguins[2, "bill_length_mm"]
```

We can see, the result is again a tibble 

The tibble consists of vectors 
If we want to extract the vector 
penguins[2][[1]]


---

### Task 1: How would we see the difference in body mass between female and male penguins?

```{r}
library(dplyr)

glimpse(penguins)
```

---

### Step 1: Subsetting

- Subset the data frame for one sex

```{r}
penguins[penguins$sex == "male",]
```

---

### Step 2: Get body mass

- Extract the vector you are interested in with the $ sign

```{r}
penguins[penguins$sex == "male",]$body_mass_g
```

---

### Step 3: Calculate the mean

- use the native `mean()` function to calculate the mean body mass

--

```{r, eval=FALSE}
mean(penguins[penguins$sex == "male",]$body_mass_g)
```

--

```{r, echo=FALSE}
mean(penguins[penguins$sex == "male",]$body_mass_g)
```

What is this?

.center[
```{r, echo=FALSE, out.width="40%"}
knitr::include_graphics("GraphicsSlides/shock.jpg")
```
]

---

### Back to Step 2: Get body mass

There are `NA` in the data!

```{r}
penguins[penguins$sex == "male",]$body_mass_g
```

---

### Back to Step 3: Calculate the mean

```{r}
mean(penguins[penguins$sex == "male",]$body_mass_g,
     na.rm = T) #<<
```

.center[
```{r, echo=FALSE, out.width="40%"}
knitr::include_graphics("GraphicsSlides/flex tape.png")
```
]

---

# More Tasks

.scroll-output[
- how many penguins on each island?
- what % of species on island "Biscoe"
- summary statistics by group "species"
- plot linear relationship between bill length and body mass

```{r}
penguins %>% 
  ggplot(aes(bill_length_mm, body_mass_g)) +
  geom_point() +
  geom_smooth(method = "lm")

plot(x = penguins$bill_length_mm, y = penguins$body_mass_g)
abline(lm(penguins$body_mass_g ~ penguins$bill_length_mm),
       col = "red", lwd = 4)
```


```{r}
lapply(penguins[, c("bill_length_mm", "bill_depth_mm")] %>% 
         na.omit(),
       mean)
```
]

---

difference male vs female penguins
male vs female body mass, bill length etc.
```{r}

#generate summary table
glimpse(penguins)

#solution
weight_male <- mean(penguins[penguins$sex == "male", "body_mass_g"][[1]], na.rm = T)
weight_female <- mean(penguins[penguins$sex == "female", "body_mass_g"][[1]], na.rm = T)

body_mass <- c(weight_male, weight_female)
gender <- c("male", "female")

comparison <- tibble(gender = gender, body_mass = body_mass)

#next lecture!
penguins |> filter(sex == "male") |> summarize(mean = mean(body_mass_g, na.rm = T))
penguins |> group_by(sex) |> summarize(weight = mean(body_mass_g, na.rm = T),
                                       bill_length = mean(bill_length_mm, na.rm = T))

penguins |>
  drop_na() |>
  group_by(sex) |>
  summarize(across(where(is.numeric),
                   mean))

penguins |>
  select(where(is.numeric))
```

Working with Tibbles
Search for Values

Logical Operations

```{r}
table(penguins$species == "Adelie")
penguins$bill_length_mm < 35

penguins[penguins$species == "Adelie" & penguins$bill_length_mm < 35, ]
penguins[penguins$species == "Adelie" & penguins$bill_length_mm < 35, c("island", "sex", "year")]
```

replace data within a Tibble

run this -> what happens
```{r, error=TRUE}
penguins[is.na(penguins$sex), "sex"] <- "undefined"
penguins[penguins$species == "Adelie",]
```
---

means averages etc... difference of weights in penguins what is the heaviest species etc...

# Bullet Point Slide

.pull-left[

- these

- are

- bullet

- points

]

.pull-right[

```{r, echo=FALSE}
mtcars %>%
  ggplot(aes(disp, mpg)) +
  geom_point() +
  geom_smooth(method = "lm")
```


]

---

# That's it for today!

**Some finishing words**

For further questions, feel free to reach out to us. Make sure to stay updated on our socials and via our website where all resources and dates are also published.

<br>

.center[
```{r, echo=FALSE, out.width="60%"}
knitr::include_graphics("GraphicsSlides/Logo RUG hell.png")
```

**[Website](https://rusergroup-sg.ch/) | [Instagram](https://www.instagram.com/rusergroupstgallen/?hl=en) | [Twitter](https://twitter.com/rusergroupsg)**

]

---

class: middle, inverse, hide-logo

# Thank you for attending!

```{r, echo=FALSE}
shiny::em(
  "The material provided in this presentation including any information, tools, features, content and any images incorporated in the presentation, is solely for your lawful, personal, private use. You may not modify, republish, or post anything you obtain from this presentation, including anything you download from our website, unless you first obtain our written consent. You may not engage in systematic retrieval of data or other content from this website. We request that you not create any kind of hyperlink from any other site to ours unless you first obtain our written permission.",
  style = "color:#404040")
```